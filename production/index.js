(()=>{var a=class{constructor(e,t){this.x=e,this.y=t}getInterpolatedCoords2d(e,t){let r=e.x-this.x,s=e.y-this.y;return new a(this.x+r*t,this.y+s*t)}getDistance(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}};var l=class{constructor(e){this.buffer=[];this.bufferSize=e}add(e){this.buffer.length<this.bufferSize?this.buffer.push(e):(this.buffer.shift(),this.buffer.push(e))}get(){return this.buffer.shift()}};var h=class{constructor(e,t,r){this.UPDATE_SPEED=1e3/60;this.INCREMENT_SPEED=1.7;this.x=e,this.y=t,this.maxRadius=r,this.currentRadius=0,this.lastTime=Date.now(),this.hasFinished=!1,this.delta=0}update(e){if(this.hasFinished)return;let t=e-this.lastTime;t>=this.UPDATE_SPEED&&this.currentRadius<this.maxRadius&&(this.delta=t-this.UPDATE_SPEED,this.currentRadius+=this.INCREMENT_SPEED,this.currentRadius>=this.maxRadius&&(this.hasFinished=!0),this.lastTime=e)}draw2dWeb(e){this.currentRadius>=this.maxRadius||(e.beginPath(),e.strokeStyle="cyan",e.lineWidth=7,e.arc(this.x,this.y,this.currentRadius,0,2*Math.PI),e.stroke())}};var m=class{constructor(e,t){this.coords2d=e,this.radius=t,this.isHit=!1}};function T(i,e,t){let r=t+Math.round(Math.random()*(i-t*2)),s=t+Math.round(Math.random()*(e-t*2));return new a(r,s)}function S(i,e,t,r){let s=[];for(let n=0;n<t;n++)for(;;){let p=!0,b=T(i,e,r);for(let u=0;u<s.length;u++)if(b.getDistance(s[u])<r*2){p=!1;break}if(p){s.push(b);break}}return s}var c=class{constructor(e,t){this.tapVisuals=[];this.legalHittableCircleIndex=0;this.gameOver=!1;this.userTapsBuffer=new l(10),this.hittableCircles=[],this.maxMemorizeTime=e,this.startingMemorizeTime=0,this.currentMemorizeTimeElapsed=0,this.nOfHittableCircles=2,this.levelComplete=!1,this.scoreStorage=t}init(){this.time=Date.now(),this.hittableCircles=S(400,400,this.nOfHittableCircles,40).map(e=>new m(e,40)),this.legalHittableCircleIndex=0,this.gameOver=!1,this.startingMemorizeTime=Date.now(),this.currentMemorizeTimeElapsed=0,this.levelComplete=!1,this.update()}processPointIfCollidesWithCircles(e){this.hittableCircles.forEach((t,r)=>{e.getDistance(t.coords2d)<t.radius&&(t.isHit=!0,r==this.legalHittableCircleIndex?this.legalHittableCircleIndex++:(this.gameOver=!0,this.scoreStorage.saveScore(this.nOfHittableCircles-1)),this.legalHittableCircleIndex==this.hittableCircles.length&&(this.nOfHittableCircles++,this.levelComplete=!0))})}update(){if(this.draw(),this.gameOver){window.alert("GAME OVER! refresh page to try again!");return}if(this.levelComplete)return this.init();let e=Date.now(),t=e-this.time;if(this.time=e,this.currentMemorizeTimeElapsed=Date.now()-this.startingMemorizeTime,this.userTapsBuffer.buffer.length>0){let r=this.userTapsBuffer.get();r&&(this.currentMemorizeTimeElapsed>this.maxMemorizeTime&&this.processPointIfCollidesWithCircles(r),this.tapVisuals.push(new h(r.x,r.y,25)))}E(this.tapVisuals),this.tapVisuals.forEach((r,s)=>{r.update(this.time)}),window.requestAnimationFrame(r=>this.update())}draw(){x(this)}};function x(i){o.save(),o.clearRect(0,0,1e4,1e4),i.hittableCircles.forEach((e,t)=>{o.beginPath(),o.strokeStyle="lime",o.textAlign="center",o.lineWidth=4,(i.currentMemorizeTimeElapsed<i.maxMemorizeTime||e.isHit)&&(o.font="48px arial",o.strokeText(t+1,e.coords2d.x,e.coords2d.y)),o.arc(e.coords2d.x,e.coords2d.y,e.radius,0,2*Math.PI),o.stroke()}),i.tapVisuals.forEach((e,t)=>{e.draw2dWeb(o)}),o.restore()}function E(i){let e=[];i.forEach((r,s)=>{r.hasFinished&&e.push(s)});let t=e.reverse();for(let r=0;r<t.length;r++)i.splice(t[r],1)}var d=class{saveScore(e){let t=localStorage.getItem("score"),r=t?Number(t):null;t||localStorage.setItem("score",String(e)),r&&e>r&&localStorage.setItem("score",String(e))}getScore(){let e=localStorage.getItem("score");return e?Number(e):0}};var f=document.getElementById("canvas"),o=f.getContext("2d");var g=new d,C=new c(2500,g);function y(i,e){var t=i.getBoundingClientRect(),r=e.clientX-t.left,s=e.clientY-t.top,n=new a(r,s);C.userTapsBuffer.add(n)}document.getElementById("score").innerHTML+="high score = "+g.getScore();f.addEventListener("click",function(i){y(f,i)});C.init();})();
